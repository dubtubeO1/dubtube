# yt-dlp: use edge (master build) instead of nix stable to fix YouTube nsig/player JS breakage.
# Standalone binary at /app/bin/yt-dlp is a Python script (#!/usr/bin/env python3); python3 required at runtime.
[phases.setup]
nixPkgs = ["nodejs_18", "python3", "ffmpeg", "curl"]

[phases.install]
cmds = [
  "npm install",
  "mkdir -p bin && curl -L -o bin/yt-dlp 'https://github.com/yt-dlp/yt-dlp-master-builds/releases/latest/download/yt-dlp' && chmod +x bin/yt-dlp"
]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "export PATH=\"/app/bin:$PATH\" && npm start"

[variables]
NODE_ENV = "production"